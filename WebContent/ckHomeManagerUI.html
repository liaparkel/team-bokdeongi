<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>BokDeongI</title>
<link
	href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
	rel="stylesheet" crossorigin="anonymous">
<link rel="stylesheet" href="css/component.css">
<link rel="stylesheet" href="css/ckHomeManagerUI.css">
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
	rel="stylesheet">
</head>

<body>
	<div class="page-layout">

		<!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
		<nav class="navbar">
			<div class="container">
				<a class="navbar-brand" href="controller?cmd=ckHomeManagerUI"> <img
					src="image/logo.png" alt="ë¡œê³ " />
				</a>
				<div class="admin-info d-flex align-items-center ms-3">
					<span class="admin-greeting">ê´€ë¦¬ìë‹˜ ì•ˆë…•í•˜ì„¸ìš”.</span>
					<button class="logout-btn ms-2">ë¡œê·¸ì•„ì›ƒ</button>
				</div>
				<div class="menu-wrapper ms-auto">
					<div class="dropdown">
						<a class="nav-link dropdown-toggle no-underline" href="#"
							role="button" data-bs-toggle="dropdown" aria-expanded="false">ì²´í¬ë¦¬ìŠ¤íŠ¸</a>
						<ul class="dropdown-menu dropdown-menu-end">
							<li><a class="dropdown-item" href="#">í˜„ì¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
							<li><a class="dropdown-item" href="#">ì´ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
						</ul>
					</div>
					<div class="dropdown">
						<a class="nav-link dropdown-toggle no-underline" href="#"
							role="button" data-bs-toggle="dropdown" aria-expanded="false">ì§€ì›ê¸ˆ
							ì •ë³´</a>
						<ul class="dropdown-menu dropdown-menu-end">
							<li><a class="dropdown-item" href="sprtManagerUI.html">í˜„ì¬
									ì§€ì›ê¸ˆ ì •ë³´</a></li>
							<li><a class="dropdown-item" href="sprtBfManagerUI.html">ì´ì „
									ì§€ì›ê¸ˆ ì •ë³´</a></li>
						</ul>
					</div>
					<div class="dropdown">
						<a class="nav-link dropdown-toggle no-underline" href="#"
							role="button" data-bs-toggle="dropdown" aria-expanded="false">ë¬¸ì˜ê´€ë¦¬</a>
						<ul class="dropdown-menu dropdown-menu-end">
							<li><a class="dropdown-item" href="#">FAQ</a></li>
							<li><a class="dropdown-item" href="#">1:1 ë¬¸ì˜ê´€ë¦¬</a></li>
						</ul>
					</div>
				</div>
			</div>
		</nav>

		<!-- ë³¸ë¬¸ -->
		<div class="main">
			<div class="container">
				<h1>ì£¼íƒì„ëŒ€ì°¨ ì•ˆë‚´ì„œ</h1>
				<div id="category-area"
					class="d-flex justify-content-between align-items-center"
					style="margin-top: 30px;">
					<div id="category-buttons" class="ck-menu"></div>
					<div class="button-group">
						<button type="button" class="btn btn-outline-secondary"
							data-bs-toggle="modal" data-bs-target="#categoryModal">+</button>
					</div>
				</div>
				<hr class="divider">
				<div class="d-flex justify-content-end">
					<button class="middle" id="editCategoryBtn" style="display: none;">ê²Œì‹œê¸€
						ìˆ˜ì •</button>
				</div>
				<div id="ck-content" class="mt-4" style="display: none;"></div>
				<div id="tip-box" class="tip-box" style="display: none;"></div>
			</div>
		</div>

		<!-- ëª¨ë‹¬ì°½ (ì¹´í…Œê³ ë¦¬ ì¶”ê°€) -->
		<div class="modal fade" id="categoryModal" tabindex="-1"
			aria-labelledby="categoryModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content" style="border-radius: 16px;">
					<div class="modal-body text-center p-4">
						<p class="mb-3">ì¶”ê°€í•  ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
						<input type="text" id="newCategoryName" class="form-control mb-3"
							placeholder="ì¹´í…Œê³ ë¦¬ëª… ì…ë ¥">
						<div class="d-flex justify-content-center gap-3">
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">ì·¨ì†Œ</button>
							<button type="button" class="btn btn-warning" id="submit">ì¶”ê°€</button>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>

	<div class="admin-info d-flex align-items-center ms-3">
		<span class="admin-greeting">ê´€ë¦¬ìë‹˜ ì•ˆë…•í•˜ì„¸ìš”.</span>
		<button class="logout-btn ms-2">ë¡œê·¸ì•„ì›ƒ</button>
	</div>
	<div class="menu-wrapper ms-auto">
		<div class="dropdown">
			<a class="nav-link dropdown-toggle no-underline" href="#"
				role="button" data-bs-toggle="dropdown" aria-expanded="false">ì²´í¬ë¦¬ìŠ¤íŠ¸</a>
			<ul class="dropdown-menu dropdown-menu-end">
				<li><a class="dropdown-item"
					href="controller?cmd=ckHomeManagerUI">í˜„ì¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
				<li><a class="dropdown-item" href="controller?cmd=#">ì´ì „
						ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
			</ul>
		</div>
		<div class="dropdown">
			<a class="nav-link dropdown-toggle no-underline" role="button"
				data-bs-toggle="dropdown" aria-expanded="false">ì§€ì›ê¸ˆ ì •ë³´</a>
			<ul class="dropdown-menu dropdown-menu-end">
				<li><a class="dropdown-item" href="sprtManagerUI.html">í˜„ì¬
						ì§€ì›ê¸ˆ ì •ë³´</a></li>
				<li><a class="dropdown-item" href="sprtBfManagerUI.html">ì´ì „
						ì§€ì›ê¸ˆ ì •ë³´</a></li>
			</ul>
		</div>
		<div class="dropdown">
			<a class="nav-link dropdown-toggle no-underline" role="button"
				data-bs-toggle="dropdown" aria-expanded="false">ë¬¸ì˜ê´€ë¦¬</a>
			<ul class="dropdown-menu dropdown-menu-end">
				<li><a class="dropdown-item" href="controller?cmd=askManagerUI">FAQ</a></li>
				<li><a class="dropdown-item"
					href="controller?cmd=soloAskManagerUI">1:1 ë¬¸ì˜ê´€ë¦¬</a></li>
			</ul>
		</div>
	</div>
	</div>
	</nav>

	<div class="main">
		<div class="container">
			<h1>ì£¼íƒì„ëŒ€ì°¨ ì•ˆë‚´ì„œ</h1>
			<div id="category-area"
				class="d-flex justify-content-between align-items-center"
				style="margin-top: 30px;">
				<div id="category-buttons" class="ck-menu"></div>
				<div class="button-group">
					<button type="button" class="btn btn-outline-secondary"
						data-bs-toggle="modal" data-bs-target="#categoryModal">+</button>
				</div>
			</div>
			<hr class="divider">
			<div class="d-flex justify-content-end">
				<button class="middle" id="editCategoryBtn" style="display: none;">ê²Œì‹œê¸€
					ìˆ˜ì •</button>
			</div>
			<div id="ck-content" class="mt-4" style="display: none;"></div>
			<div id="tip-box" class="tip-box" style="display: none;"></div>
		</div>
	</div>

	<!-- ëª¨ë‹¬ì°½ -->
	<div class="modal fade" id="categoryModal" tabindex="-1"
		aria-labelledby="categoryModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content" style="border-radius: 16px;">
				<div class="modal-body text-center p-4">
					<p class="mb-3">ì¶”ê°€í•  ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
					<input type="text" id="newCategoryName" class="form-control mb-3"
						placeholder="ì¹´í…Œê³ ë¦¬ëª… ì…ë ¥">
					<div class="d-flex justify-content-center gap-3">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">ì·¨ì†Œ</button>
						<button type="button" class="btn btn-warning" id="submit">ì¶”ê°€</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	</div>

	<script>

<script>
// í˜ì´ì§€ ë¡œë”© í›„ ì¹´í…Œê³ ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°

window.addEventListener('DOMContentLoaded', function() {
    fetchCategories();
    document.getElementById('ck-content').style.display = 'none';
    document.getElementById('tip-box').style.display = 'none';
    document.getElementById('editCategoryBtn').style.display = 'none';
});

function fetchCategories() {
    fetch('/Team_03/controller?cmd=getCkCategory')
        .then(response => response.json())
        .then(categories => {
            const categoryButtons = document.getElementById('category-buttons');
            categoryButtons.innerHTML = '';
            let firstButton = null;
            categories.forEach((categoryObj, idx) => {
                const button = document.createElement('button');
                button.classList.add('check');
                button.innerText = categoryObj.category;
                button.onclick = (event) => loadCategory(event, categoryObj.category);
                categoryButtons.appendChild(button);

                if (idx === 0) {
                    firstButton = button;
                }
            });
            if (firstButton) {
                firstButton.click();
            }
        })
        .catch(error => {
            console.error('ì¹´í…Œê³ ë¦¬ ë¡œë”© ì‹¤íŒ¨:', error);
            alert('ì¹´í…Œê³ ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
        });
}

function loadCategory(event, category) {
    const buttons = document.querySelectorAll('.check');
    buttons.forEach(btn => btn.classList.remove('checkActive'));
    event.target.classList.add('checkActive');

    fetch(`/Team_03/controller?cmd=getCkHomeInfo&category=${encodeURIComponent(category)}`)
        .then(response => response.json())
        .then(data => {
            const ckInfo = data.ckInfo;
            const contentList = data.contentList;

            document.getElementById('ck-content').style.display = 'block';
            document.getElementById('editCategoryBtn').style.display = 'inline-block';

            const ckContentDiv = document.getElementById('ck-content');
            if (contentList && contentList.length > 0) {
                ckContentDiv.innerHTML = `
                    <div class="content-list">
                        ${contentList.map(item => `
                            <div class="content-item">
                                <h2 class="content-title">${item.title}</h2>
                                <p>${item.content.replace(/(?:\r\n|\r|\n)/g, '<br>')}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                ckContentDiv.innerHTML = '<p>í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            const tipBox = document.getElementById('tip-box');
            if (ckInfo && ckInfo.tip) {
                tipBox.innerHTML = `
                    <i class="fas fa-thumbtack pin-icon"></i>
                    <div class="tip-title">TIP</div>
                    <p>${ckInfo.tip.replace(/(?:\r\n|\r|\n)/g, '<br>')}</p>
                `;
                tipBox.style.display = 'block';
            } else {
                tipBox.innerHTML = '';
                tipBox.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
            alert('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨');
        });
}

// ğŸ”¥ ëª¨ë‹¬ì°½ ì¶”ê°€ ë²„íŠ¼ (ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í›„ addCk.htmlë¡œ ì´ë™)
document.getElementById('submit').addEventListener('click', function() {
    const newCategory = document.getElementById('newCategoryName').value.trim();
    if (newCategory === '') {
        alert('ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    fetch('/Team_03/controller?cmd=addCk', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: 'category=' + encodeURIComponent(newCategory)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì„±ê³µ!');
            const modalElement = document.getElementById('categoryModal');
            const modalInstance = bootstrap.Modal.getInstance(modalElement);
            modalInstance.hide();

            window.location.href = "/Team_03/addCk.html?category=" + encodeURIComponent(data.category);
        } else {
            alert('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì‹¤íŒ¨: ' + data.message);
        }
    })
    .catch(error => {
        console.error('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì¤‘ ì—ëŸ¬:', error);
        alert('ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì‹¤íŒ¨(ì„œë²„ ì˜¤ë¥˜)');
    });
});

// ğŸ”¥ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ (setHomeManagerUI.htmlë¡œ ì´ë™)
document.getElementById('editCategoryBtn').addEventListener('click', function() {
    const activeBtn = document.querySelector('.checkActive');
    if (!activeBtn) {
        alert('ìˆ˜ì •í•  ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    const selectedCategory = activeBtn.innerText.trim();
    window.location.href = "setHomeManagerUI.html?category=" + encodeURIComponent(selectedCategory);
});
</script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
		crossorigin="anonymous"></script>
</body>
</html>
